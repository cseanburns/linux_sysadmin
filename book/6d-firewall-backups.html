<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Firewalls and Backups - Linux Systems Administration</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="Entry level book on Linux systems administration.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="p1-linux-sysadmin.html"><strong aria-hidden="true">1.</strong> Linux Systems Administration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="1a-history-linux-unix.html"><strong aria-hidden="true">1.1.</strong> History of Unix and Linux</a></li><li class="chapter-item expanded "><a href="1b-what-is-linux.html"><strong aria-hidden="true">1.2.</strong> What is Linux?</a></li><li class="chapter-item expanded "><a href="1c-what-is-sysadmin.html"><strong aria-hidden="true">1.3.</strong> What is Systems Administration?</a></li></ol></li><li class="chapter-item expanded "><a href="p2-project-management.html"><strong aria-hidden="true">2.</strong> Project Management</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="2a-using-gcloud-virtual-machines.html"><strong aria-hidden="true">2.1.</strong> Using gcloud for Virtual Machines</a></li><li class="chapter-item expanded "><a href="2b-using-git-github-for-documentation.html"><strong aria-hidden="true">2.2.</strong> Using Git and GitHub for Documentation</a></li></ol></li><li class="chapter-item expanded "><a href="p3-the-command-line.html"><strong aria-hidden="true">3.</strong> Learning the Command Line</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="3a-the-linux-filesystem.html"><strong aria-hidden="true">3.1.</strong> The Linux Filesystem</a></li><li class="chapter-item expanded "><a href="3b-files-and-directories.html"><strong aria-hidden="true">3.2.</strong> Files and Directories</a></li><li class="chapter-item expanded "><a href="3c-file-perms-owns.html"><strong aria-hidden="true">3.3.</strong> File Permissions and Ownership</a></li><li class="chapter-item expanded "><a href="3d-text-processing-part-1.html"><strong aria-hidden="true">3.4.</strong> Text Processing: Part 1</a></li><li class="chapter-item expanded "><a href="3e-text-processing-part-2.html"><strong aria-hidden="true">3.5.</strong> Text Processing: Part 2</a></li><li class="chapter-item expanded "><a href="3f-review.html"><strong aria-hidden="true">3.6.</strong> Review</a></li></ol></li><li class="chapter-item expanded "><a href="p4-scripting-the-command-line.html"><strong aria-hidden="true">4.</strong> Scripting the Command Line</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="4a-text-editors.html"><strong aria-hidden="true">4.1.</strong> Text Editors</a></li><li class="chapter-item expanded "><a href="4b-regular-expressions.html"><strong aria-hidden="true">4.2.</strong> Regular Expressions</a></li><li class="chapter-item expanded "><a href="4c-bash-scripting.html"><strong aria-hidden="true">4.3.</strong> Bash Scripting</a></li></ol></li><li class="chapter-item expanded "><a href="p5-managing-the-system.html"><strong aria-hidden="true">5.</strong> Managing the System</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="5a-expanding-storage.html"><strong aria-hidden="true">5.1.</strong> Expanding Storage</a></li><li class="chapter-item expanded "><a href="5b-managing-users-groups.html"><strong aria-hidden="true">5.2.</strong> Managing Users and Groups</a></li><li class="chapter-item expanded "><a href="5c-managing-software.html"><strong aria-hidden="true">5.3.</strong> Managing Software</a></li><li class="chapter-item expanded "><a href="5d-using-systemd.html"><strong aria-hidden="true">5.4.</strong> Using systemd</a></li></ol></li><li class="chapter-item expanded "><a href="p6-networking-security.html"><strong aria-hidden="true">6.</strong> Networking and Security</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="6a-networking-tcpip.html"><strong aria-hidden="true">6.1.</strong> Networking and TCP/IP</a></li><li class="chapter-item expanded "><a href="6b-dns-domain-names.html"><strong aria-hidden="true">6.2.</strong> DNS and Domain Names</a></li><li class="chapter-item expanded "><a href="6c-local-security.html"><strong aria-hidden="true">6.3.</strong> Local Security</a></li><li class="chapter-item expanded "><a href="6d-firewall-backups.html" class="active"><strong aria-hidden="true">6.4.</strong> Firewalls and Backups</a></li></ol></li><li class="chapter-item expanded "><a href="p7-creating-a-lamp-server.html"><strong aria-hidden="true">7.</strong> Creating a LAMP Server</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="7a-installing-the-apache-web-server.html"><strong aria-hidden="true">7.1.</strong> Installing the Apache Web Server</a></li><li class="chapter-item expanded "><a href="7b-installing-configuring-php.html"><strong aria-hidden="true">7.2.</strong> Installing and Configuring PHP</a></li><li class="chapter-item expanded "><a href="7c-installing-configuring-mariadb.html"><strong aria-hidden="true">7.3.</strong> Installing and Configuring MariaDB</a></li><li class="chapter-item expanded "><a href="7d-install-wordpress.html"><strong aria-hidden="true">7.4.</strong> Installing WordPress</a></li></ol></li><li class="chapter-item expanded "><a href="p8-conclusion.html"><strong aria-hidden="true">8.</strong> Conclusion</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Linux Systems Administration</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/cseanburns/linux_sysadmin" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="firewalls-and-backups"><a class="header" href="#firewalls-and-backups">Firewalls and Backups</a></h1>
<p>By the end of this section, you should know:</p>
<ol>
<li><strong>The Role of Firewalls in Network Security</strong>:
<ul>
<li>How firewalls control incoming (ingress) and outgoing (egress) traffic at different network layers.</li>
<li>The difference between link, IP, transport, and application layer rules.</li>
</ul>
</li>
<li><strong>Firewall Configuration in Cloud and Local Environments</strong>:
<ul>
<li>How to create, manage, and prioritize firewall rules in Google Cloud using the VPC network interface.</li>
<li>How to use Google Cloud's firewall capabilities to block specific types of traffic, such as ICMP (used by tools like <code>ping</code> and <code>traceroute</code>).</li>
</ul>
</li>
<li><strong>Understanding Google Cloud Firewall Features</strong>:
<ul>
<li>The concept of default VPC firewall rules and how to override them with higher priority rules.</li>
<li>How to configure firewall rules to enhance security at the network level.</li>
</ul>
</li>
<li><strong>Configuring Local Firewalls with Ubuntu's <code>ufw</code></strong>:
<ul>
<li>How to enable and disable <code>ufw</code> for local firewall management on Ubuntu systems.</li>
<li>Basic commands to allow or deny access to specific ports or services, such as SSH (port 22) or HTTP (port 80).</li>
<li>The use of application profiles in <code>/etc/ufw/applications.d</code> to simplify firewall rule creation for services like Apache.</li>
</ul>
</li>
<li><strong>Backup Strategies for Physical and Cloud Systems</strong>:
<ul>
<li>The difference between backing up virtual machines with Google Cloud snapshots and using local tools for bare metal systems.</li>
<li>How to create and manage Google Cloud snapshots for disaster recovery and replication purposes.</li>
</ul>
</li>
<li><strong>Using <code>rsync</code> for Backup and Synchronization</strong>:
<ul>
<li>How to use <code>rsync</code> to copy files and directories locally and to a remote server over SSH.</li>
<li>The effect of the trailing slash in <code>rsync</code> commands, and how it changes the behavior of the copy operation.</li>
<li>How to use the <code>--delete</code> option in <code>rsync</code> to synchronize directories by removing files that no longer exist in the source directory.</li>
</ul>
</li>
<li><strong>Understanding the Utility of Different Backup and Security Options</strong>:
<ul>
<li>When to use Google Cloud firewall versus a local firewall (<code>ufw</code>) and when to use snapshots versus tools like <code>rsync</code> based on your needs.</li>
<li>The advantages and limitations of each approach to both firewall management and backup strategies.</li>
</ul>
</li>
</ol>
<h2 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h2>
<p>Most security challenges come from outside of a local network, and the attack vectors are fairly broad.
To reduce the vulnerabilities of our systems, a systems administrator must be able to handle the following kinds of tasks:</p>
<ul>
<li>firewall configuration and management</li>
<li>access control management</li>
<li>network monitoring and intrusion detection</li>
<li>patch management</li>
<li>VPN configuration and management</li>
<li>network segmentation</li>
<li>password and authentication policy enforcement</li>
<li>logging and auditing</li>
<li>security policies and documentation</li>
<li>incident response and disaster recovery planning</li>
<li>security vulnerability assessments</li>
<li>network hardening</li>
<li>encryption implementation</li>
<li>DNS security</li>
<li>endpoint security integration</li>
</ul>
<p>We have covered some of the tasks above.
For example, we learned how to create user accounts and password policies, and both of these are a form of access control management.
We learned about sub-networking, which is a form of network segmentation.
We learned about the DNS system, which is a fundamental aspect of DNS security.
We developed <code>bash</code> scripts to examine log files, which is helpful to understand logging and auditing.
We learned how to install software and keep our systems updated, which is a form of patch management.
Although we can only cover so much and there is a lot more to learn,
in this section we'll begin to learn firewall configuration and management.
We will also learn how to create systematic backups of our instances, which is an important part of disaster recovery planning.</p>
<h2 id="firewalls"><a class="header" href="#firewalls">Firewalls</a></h2>
<p>A firewall program allows or denies connections for incoming (aka, <strong>ingress</strong>) or outgoing (aka, <strong>egress</strong>) traffic.
Traffic can be controlled through the:</p>
<ul>
<li>link layer: a network interface such as an ethernet or wireless card,</li>
<li>IP layer: IPv4 or IPv6 address or address ranges,</li>
<li>transport layer: TCP, UDP, ICMP, etc., or</li>
<li>by the application layer via port numbers: HTTP (port 80), HTTPS (port 443), SSH (port 22), SMTP (port 465), etc.</li>
</ul>
<p>Firewalls have other abilities.
For example, they can be used to:</p>
<ul>
<li>place limits on the number of attempts to connect,</li>
<li>create virtual private networks, and</li>
<li>throttle bandwidth for certain applications, ports, etc.</li>
</ul>
<blockquote>
<p>As a side note, bare metal servers may have multiple ethernet network interface cards (NICs).
Each NIC would, of course, have its own MAC address, and therefore would be assigned different IP addresses.
Thus, at the link layer, incoming connections can be completely blocked on one card and outgoing connections can be completely blocked on the other.</p>
</blockquote>
<p>To manage these connections, firewalls apply <strong>rules</strong>.
A rule may block all incoming connections, but then allow SSH traffic through port 22, either via TCP or UDP, and
then further restrict SSH connections to a specific IP range.
And/or, another rule may block all incoming, unencrypted HTTP connections through port 80,
but allow all incoming, encrypted HTTPS connections through port 443.</p>
<h3 id="firewalls-on-google-cloud"><a class="header" href="#firewalls-on-google-cloud">Firewalls on Google Cloud</a></h3>
<p>Let's cover using Google Cloud to create a basic firewall rule.
This will prepare us for setting up new rules when we configure our <strong>LAMP</strong> servers in the next section.</p>
<blockquote>
<p>LAMP originally referred to <strong>Linux</strong>, <strong>Apache</strong>, <strong>MySQL</strong>, and <strong>PHP</strong>.
These four technologies together create a web server.
Technically, only Linux (or some other OS) and Apache (or some other web server software) are needed to serve a website.
At a basic level, all a web server does is open up an operating system's filesystem to the world.
But PHP and MySQL provide additional functionality, like the ability for a website to interact with a relational database.
The <strong>M</strong> in LAMP may also refer to MariaDB, which is a fully open source clone of MySQL.
Other relational databases are usable, too, such as <a href="https://www.postgresql.org/">PostgreSQL</a> or <a href="https://www.sqlite.org/">SQLite</a>.
We'll use MariaDB later in this course.</p>
</blockquote>
<p>First review how our Google Cloud instances are <a href="https://cloud.google.com/vpc/docs/firewalls#more_rules_default_vpc">pre-populated with default firewall rules</a> at the network level.
Follow that with a review of the firewall <a href="https://cloud.google.com/vpc/docs/firewalls">documentation</a>, which provides an overview of the rules we'll use.</p>
<h4 id="block-the-ping-application"><a class="header" href="#block-the-ping-application">Block the <code>ping</code> application</a></h4>
<p>We'll begin by implementing a basic firewall rule where we block incoming <a href="https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol">ICMP traffic</a>.
ICMP traffic is used by several applications, such as <code>ping</code> and <code>traceroute</code>.
The <code>ping</code> command is a simple tool that can test whether a server at an IP address or domain is running.
It's useful for error reporting and network diagnostics.
The <code>traceroute</code> command is used to display the path between two internet devices.
While both are useful, we may want to block that traffic to prevent others from gaining information about our servers.
To do so:</p>
<ol>
<li>In the Google Cloud Console, click on <strong>VPC network</strong> and select <strong>Firewall</strong>.</li>
<li>The default VPC firewall rules are listed that allow for HTTP, ICMP, RDP, and SSH traffic.</li>
<li>Priority settings are set for each rule. Lower numbers mean the rules have a higher priority.</li>
<li>The predefined rules allow for incoming ICMP traffic set at a priority level of 65534.</li>
<li>We could delete that, but we should leave these rules in place and create a higher priority rule that will supersede that.</li>
<li>Click on <strong>Create Firewall Rule</strong>.</li>
<li>For name, enter <strong>new-deny-icmp</strong>.</li>
<li>Keep priority at 1000.</li>
<li>Under <strong>Direction of traffic</strong>, keep as <strong>Ingress</strong>.</li>
<li>Under <strong>Action on match</strong>, select <strong>Deny</strong>.</li>
<li>In the <strong>Source IPv4</strong> ranges, enter <strong>0.0.0.0/0</strong> for all network traffic.</li>
<li>Under <strong>Protocols and ports</strong>, select <strong>Other</strong>, and type in <strong>icmp</strong>.</li>
<li>Click the <strong>Create</strong> button to create the rule.</li>
</ol>
<p>On the <strong>VM instances</strong> page, you can find the external IP address for your virtual machine.
For example, let's say mine is 33.333.333.100.
From my laptop, if I try to ping that IP address, I should not get a response.</p>
<p>Once you have tested this rule, feel free to keep or delete it.
To delete it, select the check box next to the rule, and then click the <strong>Delete</strong> button.</p>
<blockquote>
<p>Note: Google's Firewall rules, at extra cost, now offer the ability to block
specific domains (FQDN-based firewalls) and to block geographical regions.</p>
</blockquote>
<h3 id="os-firewall-applications"><a class="header" href="#os-firewall-applications">OS Firewall Applications</a></h3>
<p>In case you are working on firewalls on a specific machine instead of on the cloud,
then you would want to become familiar with Linux-based firewall applications.</p>
<p>On Ubuntu, the main firewall application is <a href="https://help.ubuntu.com/community/UFW">ufw</a>.
On RedHat-based distributions, the main firewall application is <a href="https://docs.fedoraproject.org/en-US/quick-docs/firewalld/">firewalld</a>.
Both of these firewall applications are user-friendly front-ends of the <a href="https://www.netfilter.org/">iptables</a> firewall application,
which is built into the Linux kernel.
Although we are using an Ubuntu distribution as our virtual machines, Ubuntu's <code>ufw</code> firewall is disabled by default.
This is likely because it may be overkill to use both Google Cloud's firewall and Ubuntu's <code>ufw</code>.</p>
<blockquote>
<p>FreeBSD and OpenBSD, two non-Linux but Unix-like operating systems, offer <code>pf</code>:
<a href="https://docs.freebsd.org/en/books/handbook/firewalls/"><code>pf</code> on FreeBSD</a> and <a href="https://www.openbsd.org/faq/pf/"><code>pf</code> on OpenBSD</a>.
These BSD OSes are often used to build firewall servers.</p>
</blockquote>
<p><code>ufw</code> (Uncomplicated Firewall) is a user-friendly command-line firewall utility.
It simplifies firewall configuration on Debian-based Linux operating systems, such as Ubuntu.
It is designed to provide a more user friendly interface to the underlying <code>iptables</code> application.
However, it is still powerful enough to secure a system effectively.</p>
<h4 id="basic-features"><a class="header" href="#basic-features">Basic Features</a></h4>
<ul>
<li><strong>Enable/Disable Firewall</strong>:
<ul>
<li>Enable: <code>sudo ufw enable</code></li>
<li>Disable: <code>sudo ufw disable</code></li>
</ul>
</li>
<li>Allow/Deny Access:
<ul>
<li>Allow access to port 22 (<code>ssh</code>): <code>sudo ufw allow 22</code></li>
<li>Deny access to port 80 (<code>http</code>): <code>sudo ufw deny 80</code></li>
<li>Other services can be set based on the contents of the <code>/etc/services</code> file.</li>
</ul>
</li>
<li>Status and Logging:
<ul>
<li>Check <code>ufw</code> status: <code>sudo ufw status</code></li>
<li>Log firewall entries: <code>sudo ufw logging on</code></li>
<li>Change logging level: <code>sudo ufw logging low</code></li>
<li>View log entries: <code>sudo less /var/log/ufw.log</code></li>
</ul>
</li>
</ul>
<p><code>ufw</code> can also control the firewall based on a list of profiles and predefined rules.
These profiles and predefined rules are contained in the <code>/etc/ufw/applications.d</code> directory.
For example, there are three protocols for the <code>apache2</code> web server: <strong>Apache</strong>, <strong>Apache Secure</strong>, and <strong>Apache Full</strong>.
These are defined in <code>/etc/ufw/applications.d/apache2-utils.ufw.profile</code> file:</p>
<pre><code>[Apache]
title=Web Server
description=Apache v2 is the next generation of the omnipresent Apache web server.
ports=80/tcp

[Apache Secure]
title=Web Server (HTTPS)
description=Apache v2 is the next generation of the omnipresent Apache web server.
ports=443/tcp

[Apache Full]
title=Web Server (HTTP,HTTPS)
description=Apache v2 is the next generation of the omnipresent Apache web server.
ports=80,443/tcp
</code></pre>
<p>Based on the above profile, we can set <code>ufw</code> for Apache like so:</p>
<pre><code>sudo ufw allow 'Apache Full'
</code></pre>
<p>To see other examples, read: <a href="https://ubuntu.com/server/docs/firewalls">ufw documentation</a>.
If you are using a RedHat distribution of Linux, then checkout <a href="https://www.redhat.com/en/blog/beginners-guide-firewalld">A Beginner's Guide to firewalld in Linux</a>.</p>
<h2 id="backups"><a class="header" href="#backups">Backups</a></h2>
<p>Catastrophes (natural, physical, criminal, or out of negligence) happen.
As a systems administrator, you may be required to have backup strategies to mitigate data loss.</p>
<p>How you backup depends on the machine.
If I am managing bare metal, and I want to backup a physical disk to another physical disk, then that requires a specific tool.
However, if I am managing virtual machines, like our Google Cloud instance, then that requires a different tool.
Therefore, in this section, I will briefly cover both scenarios.</p>
<h3 id="google-cloud-snapshots"><a class="header" href="#google-cloud-snapshots">Google Cloud Snapshots</a></h3>
<p>Since our instance on Google Cloud is a virtual machine, we can use the Google Cloud console to create <strong>snapshots</strong> of our instance.
A <strong>snapshot</strong> is a copy of a virtual machine at the time the snapshot was taken.
What's great about taking a snapshot is that the result is basically a file of a complete operating system.
Since it's a file, it can itself be used in other projects or used to restore a machine to the time the snapshot was taken.</p>
<p>Snapshots may also be used to document or reproduce work.
For example, if I worked with programmers, as a systems administrator,
I might help a programmer share snapshots of a virtual machine with other programmers.
Those other programmers could then restore the snapshot in their own instances, and see and run the original work in the environment it was created in.</p>
<p>Taking snapshots in Google Cloud is very straightforward, but since it does take up extra storage, it will accrue extra costs.
Since we want avoid that for now, please see the following documentation for how to take a snapshot in Google Cloud:</p>
<p><a href="https://cloud.google.com/compute/docs/disks/create-snapshots">Create and manage disk snapshots</a></p>
<ol>
<li>Click on <strong>Compute Engine</strong>.</li>
<li>Click on <strong>Snapshots</strong>.</li>
<li>Click on <strong>Create Snapshot</strong>.</li>
<li>Enter a name for your snapshot.</li>
<li>Select the <strong>Source disk</strong>.</li>
<li>Select <strong>Snapshot</strong> under the <strong>Type</strong> section.</li>
<li>Click on <strong>Create</strong>.</li>
</ol>
<h3 id="rsync"><a class="header" href="#rsync"><code>rsync</code></a></h3>
<p>If we were managing bare metal machines, then we might use a program like <code>rsync</code> to backup physical disk drives.
<code>rsync</code> is a powerful program.
It can copy disks, directories, and files.
It can copy files from one location, and send the copies, encrypted, to a remote server.</p>
<p>For example, let's say I mount an external hard drive to my filesystem at <strong>/mnt/backup</strong>.
To copy my home directory, I'd use:</p>
<pre><code>rsync -av /home/me/ /mnt/backup/
</code></pre>
<p>where <strong>/home/me/</strong> is the <strong>source directory</strong>, and <strong>/mnt/backup/</strong> is the <strong>destination directory</strong>.</p>
<p>Syntax matters here.
If I include the trailing slash on the source directory, then <code>rsync</code> will copy everything in <strong>/home/me/</strong> to <strong>/mnt/backup/</strong>.
However, if I leave the trailing slash off, like so:</p>
<pre><code>rsync -av /home/me /mnt/backup/
</code></pre>
<p>then the result will be that the directory <strong>me/</strong> will be copied to <strong>/mnt/backup/me/</strong>.</p>
<p>Let's see this in action.
Say I have two directories.
In the <strong>tmp1/</strong> directory, there are two files: <strong>file1</strong> and <strong>file2</strong>.
The <strong>tmp2/</strong> directory is empty.
To copy <strong>file1</strong> and <strong>file2</strong> to <strong>tmp2</strong>, then:</p>
<pre><code>ls tmp1/
file1 file2
rsync -av tmp1/ tmp2/
ls tmp2
file1 file2
</code></pre>
<p>However, if I leave that trailing slash off the source directory, then the <strong>tmp1/</strong> will get copied to <strong>tmp2/</strong>:</p>
<pre><code>ls tmp1
file1 file2
rsync -av tmp1 tmp2/
ls tmp2/
tmp1/
ls tmp2/tmp1/
file1 file2
</code></pre>
<p><code>rsync</code> can also send a source directory to a directory on a remote server, and the directory and files being copied will be encrypted on the way.
To do this, we use <code>ssh</code> style syntax:</p>
<pre><code>rsync -av tmp1/ USER@REMOTE:~/tmp2/
</code></pre>
<p>For example:</p>
<pre><code>rsync -av tmp1 linus@222.22.33.333:~/tmp2/
</code></pre>
<h3 id="delete-option"><a class="header" href="#delete-option">Delete Option</a></h3>
<p><code>rsync</code> has a <code>--delete</code> option.
Adding this option means that <code>rsync</code> will synchronize the source directory with the destination directory.
This means that if I had already created a backup of <strong>tmp1</strong> to <strong>tmp2</strong>, and then delete <strong>file1</strong> in <strong>tmp1</strong> later,
then run <code>rsync</code> with the delete option, then <code>rsync</code> will also delete <strong>file1</strong> from <strong>tmp2/</strong>.
This is how that looks:</p>
<pre><code>ls tmp1/
file1 file2
rsync -av tmp1/ tmp2/
ls tmp2/
file1 file2
rm tmp1/file1
ls tmp1/
file2
rsync -av --delete tmp1/ tmp2/
ls tmp2
file2
</code></pre>
<p>Backups are no good if we don't know how to restore a backup to a disk.
To restore with <code>rsync</code>, we just reverse the destination directory with the source directory:</p>
<pre><code>rsync -av tmp2/ tmp1/
</code></pre>
<h2 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h2>
<p>System security involves a multi-vectored approach that includes many tasks, from password management to log audits.
In this section, we covered firewalls and backups, and have thus addressed new vectors to protect:
firewall configuration and management and disaster recovery.</p>
<p>Since we're running an Ubuntu server on Google Cloud,
we have Google Cloud options for creating firewall rules at the network level and for backing up disks as snapshots.
We also have Ubuntu options for creating firewall rules at the OS level using <code>ufw</code> and for backing up disks using commands like <code>rsync</code>.
How we go about either depends entirely on our needs or on our organization's needs.
But knowing these options exist and the different reasons why we have these options, provides quite a bit of utility.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="6c-local-security.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="p7-creating-a-lamp-server.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="6c-local-security.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="p7-creating-a-lamp-server.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
